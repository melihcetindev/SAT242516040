@page "/kitapekle"
@using DbContexts
@using SAT242516040.Models
@inject MyDbModel_DbContext _db

<div class="page-container">
    <div class="glass-card p-8 w-full max-w-lg">
        <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Yayın (Kitap) Ekle</h2>

        <EditForm Model="@yeniYayin" OnValidSubmit="@Kaydet" FormName="yayinForm">
            <DataAnnotationsValidator />

            <div class="space-y-4">
                <InputText @bind-Value="yeniYayin.Baslik" class="input-modern" placeholder="Başlık" />
                <ValidationMessage For="@(() => yeniYayin.Baslik)" />

                <InputDate @bind-Value="yeniYayin.YayinTarihi" class="input-modern" />
                <ValidationMessage For="@(() => yeniYayin.YayinTarihi)" />

                <InputText @bind-Value="yeniYayin.Dergi" class="input-modern" placeholder="Dergi" />
                <ValidationMessage For="@(() => yeniYayin.Dergi)" />

                <InputSelect @bind-Value="yeniYayin.YazarId" class="input-modern">
                    <option value="">Yazar Seçin</option>
                    @foreach (var yazar in yazarlar)
                    {
                        <option value="@yazar.Id">@yazar.Ad @yazar.Soyad</option>
                    }
                </InputSelect>
                <ValidationMessage For="@(() => yeniYayin.YazarId)" />

                <button type="submit" class="w-full py-3 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-semibold transition-all">
                    Yayını Kaydet
                </button>
            </div>
        </EditForm>


        @if (!string.IsNullOrEmpty(mesaj))
        {
            <div class="mt-4 text-green-600 font-medium">@mesaj</div>
        }
    </div>
</div>

@code {
    private Yayin yeniYayin = new();
    private List<Yazar> yazarlar = new();
    private string mesaj = "";

    protected override void OnInitialized()
    {
        yazarlar = _db.Yazarlar.ToList();
    }

    private async Task Kaydet()
    {
        _db.Yayinlar.Add(yeniYayin);
        await _db.SaveChangesAsync();
        mesaj = $"{yeniYayin.Baslik} başarıyla eklendi!";
        yeniYayin = new();
    }
}
